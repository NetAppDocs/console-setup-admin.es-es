---
sidebar: sidebar 
permalink: task-install-agent-azure-marketplace.html 
keywords: install connector, azure connector installation, azure connector, install connector in azure, bluexp, create connector, marketplace, azure marketplace 
summary: Para crear un agente de consola desde Azure Marketplace, debe configurar su red, preparar los permisos de Azure, revisar los requisitos de la instancia y luego crear el agente de consola. 
---
= Crear un agente de consola desde Azure Marketplace
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Puede crear un agente de consola en Azure directamente desde Azure Marketplace.  Para crear un agente de consola desde Azure Marketplace, debe configurar su red, preparar los permisos de Azure, revisar los requisitos de la instancia y luego crear el agente de consola.

.Antes de empezar
* Deberías tener unalink:concept-agents.html["comprensión de los agentes de consola"] .
* Revisarlink:reference-limitations.html["Limitaciones del agente de consola"] .




== Paso 1: Configurar la red

Asegúrese de que la ubicación de red donde planea instalar el agente de consola admita los siguientes requisitos. Estos requisitos permiten que el agente de consola administre recursos en su nube híbrida.

Región de Azure:: Si usa Cloud Volumes ONTAP, el agente de la consola debe implementarse en la misma región de Azure que los sistemas Cloud Volumes ONTAP que administra, o en la https://docs.microsoft.com/en-us/azure/availability-zones/cross-region-replication-azure#azure-cross-region-replication-pairings-for-all-geographies["Par de regiones de Azure"^] para los sistemas Cloud Volumes ONTAP .  Este requisito garantiza que se utilice una conexión de Azure Private Link entre Cloud Volumes ONTAP y sus cuentas de almacenamiento asociadas.
+
--
https://docs.netapp.com/us-en/storage-management-cloud-volumes-ontap/task-enabling-private-link.html["Descubra cómo Cloud Volumes ONTAP utiliza un enlace privado de Azure"^]

--


VNet y subred:: Al crear el agente de consola, debe especificar la red virtual y la subred donde debe residir.


Conexiones a redes de destino:: El agente de consola requiere una conexión de red a la ubicación donde planea crear y administrar sistemas.  Por ejemplo, la red donde planea crear sistemas Cloud Volumes ONTAP o un sistema de almacenamiento en su entorno local.


Acceso a Internet de salida:: La ubicación de red donde implementa el agente de consola debe tener una conexión a Internet saliente para comunicarse con puntos finales específicos.


Puntos finales contactados desde el agente de la consola:: El agente de la consola requiere acceso a Internet saliente para comunicarse con los siguientes puntos finales para administrar recursos y procesos dentro de su entorno de nube pública para las operaciones diarias.
+
--
Los puntos finales enumerados a continuación son todas entradas CNAME.

[cols="2a,1a"]
|===
| Puntos finales | Objetivo 


 a| 
\ https://management.azure.com \ https://login.microsoftonline.com \ https://blob.core.windows.net \ https://core.windows.net
 a| 
Para administrar recursos en regiones públicas de Azure.



 a| 
\ https://management.chinacloudapi.cn \ https://login.chinacloudapi.cn \ https://blob.core.chinacloudapi.cn \ https://core.chinacloudapi.cn
 a| 
Para administrar recursos en las regiones de Azure China.



 a| 
\ https://mysupport.netapp.com
 a| 
Para obtener información de licencias y enviar mensajes de AutoSupport al soporte de NetApp .



 a| 
\ https://support.netapp.com
 a| 
Para obtener información de licencias y enviar mensajes de AutoSupport al soporte de NetApp .



 a| 
\ https://signin.b2c.netapp.com
 a| 
Para actualizar las credenciales del sitio de soporte de NetApp (NSS) o para agregar nuevas credenciales de NSS a la NetApp Console.



 a| 
\ https://support.netapp.com
 a| 
Para obtener información de licencias y enviar mensajes de AutoSupport al soporte de NetApp , así como para recibir actualizaciones de software para Cloud Volumes ONTAP.



 a| 
\ https://api.bluexp.netapp.com \ https://netapp-cloud-account.auth0.com \ https://netapp-cloud-account.us.auth0.com \ https://console.netapp.com \ https://components.console.bluexp.netapp.com \ https://cdn.auth0.com
 a| 
Proporcionar funciones y servicios dentro de la NetApp Console.



 a| 
\ https://bluexpinfraprod.eastus2.data.azurecr.io \ https://bluexpinfraprod.azurecr.io
 a| 
Para obtener imágenes para las actualizaciones del agente de consola.

* Cuando se implementa un nuevo agente, la verificación de validación prueba la conectividad con los puntos finales actuales.  Si utilizaslink:link:reference-networking-saas-console-previous.html["puntos finales anteriores"] , la comprobación de validación falla.  Para evitar este error, omita la comprobación de validación.
+
Aunque los puntos finales anteriores aún son compatibles, NetApp recomienda actualizar las reglas de firewall a los puntos finales actuales lo antes posible. link:reference-networking-saas-console-previous.html#update-endpoint-list["Aprenda a actualizar su lista de puntos finales"] .

* Cuando actualice los puntos finales actuales en su firewall, sus agentes existentes continuarán funcionando.


|===
--


Servidor proxy:: NetApp admite configuraciones de proxy explícitas y transparentes.  Si está utilizando un proxy transparente, solo necesita proporcionar el certificado para el servidor proxy.  Si está utilizando un proxy explícito, también necesitará la dirección IP y las credenciales.
+
--
* Dirección IP
* Cartas credenciales
* Certificado HTTPS


--


Puertos:: No hay tráfico entrante al agente de la consola, a menos que usted lo inicie o si se utiliza como proxy para enviar mensajes de AutoSupport desde Cloud Volumes ONTAP al soporte de NetApp .
+
--
* HTTP (80) y HTTPS (443) brindan acceso a la interfaz de usuario local, que utilizará en circunstancias excepcionales.
* SSH (22) solo es necesario si necesita conectarse al host para solucionar problemas.
* Se requieren conexiones entrantes a través del puerto 3128 si implementa sistemas Cloud Volumes ONTAP en una subred donde no hay una conexión a Internet saliente disponible.
+
Si los sistemas Cloud Volumes ONTAP no tienen una conexión a Internet saliente para enviar mensajes de AutoSupport , la consola configura automáticamente esos sistemas para usar un servidor proxy que está incluido con el agente de la consola.  El único requisito es garantizar que el grupo de seguridad del agente de la consola permita conexiones entrantes a través del puerto 3128.  Necesitará abrir este puerto después de implementar el agente de consola.



--


Habilitar NTP:: Si planea utilizar NetApp Data Classification para escanear sus fuentes de datos corporativos, debe habilitar un servicio de Protocolo de tiempo de red (NTP) tanto en el agente de consola como en el sistema de NetApp Data Classification para que la hora se sincronice entre los sistemas. https://docs.netapp.com/us-en/data-services-data-classification/concept-cloud-compliance.html["Obtenga más información sobre la clasificación de datos de NetApp"^]
+
--
Implemente los requisitos de red después de crear el agente de consola.

--




== Paso 2: Revisar los requisitos de la máquina virtual

Al crear el agente de consola, elija un tipo de máquina virtual que cumpla con los siguientes requisitos.

UPC:: 8 núcleos u 8 vCPU
RAM:: 32 GB
Tamaño de la máquina virtual de Azure:: Un tipo de instancia que cumple con los requisitos de CPU y RAM anteriores.  Recomendamos Standard_D8s_v3.




== Paso 3: Configurar permisos

Puede proporcionar permisos de las siguientes maneras:

* Opción 1: Asignar un rol personalizado a la máquina virtual de Azure mediante una identidad administrada asignada por el sistema.
* Opción 2: proporcione a la consola las credenciales de una entidad de servicio de Azure que tenga los permisos necesarios.


Siga estos pasos para configurar permisos para la consola.

[role="tabbed-block"]
====
.Rol personalizado
--
Tenga en cuenta que puede crear un rol personalizado de Azure mediante el portal de Azure, Azure PowerShell, la CLI de Azure o la API REST.  Los siguientes pasos muestran cómo crear el rol mediante la CLI de Azure.  Si prefiere utilizar un método diferente, consulte https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles#steps-to-create-a-custom-role["Documentación de Azure"^]

.Pasos
. Si planea instalar manualmente el software en su propio host, habilite una identidad administrada asignada por el sistema en la máquina virtual para poder proporcionar los permisos de Azure necesarios a través de un rol personalizado.
+
https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm["Documentación de Microsoft Azure: Configurar identidades administradas para recursos de Azure en una máquina virtual mediante el portal de Azure"^]

. Copiar el contenido dellink:reference-permissions-azure.html["Permisos de roles personalizados para el Conector"] y guardarlos en un archivo JSON.
. Modifique el archivo JSON agregando identificadores de suscripción de Azure al ámbito asignable.
+
Debe agregar el ID de cada suscripción de Azure que desee utilizar con la NetApp Console.

+
*Ejemplo*

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz",
"/subscriptions/54b91999-b3e6-4599-908e-416e0zzzzzzz",
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"
----
. Utilice el archivo JSON para crear un rol personalizado en Azure.
+
Los siguientes pasos describen cómo crear el rol mediante Bash en Azure Cloud Shell.

+
.. Comenzar https://docs.microsoft.com/en-us/azure/cloud-shell/overview["Azure Cloud Shell"^] y elija el entorno Bash.
.. Sube el archivo JSON.
+
image:screenshot_azure_shell_upload.png["Una captura de pantalla de Azure Cloud Shell donde puede elegir la opción de cargar un archivo."]

.. Utilice la CLI de Azure para crear el rol personalizado:
+
[source, azurecli]
----
az role definition create --role-definition Connector_Policy.json
----




--
.Director de servicio
--
Cree y configure una entidad de servicio en Microsoft Entra ID y obtenga las credenciales de Azure que necesita la consola.

.Cree una aplicación Microsoft Entra para el control de acceso basado en roles
. Asegúrese de tener permisos en Azure para crear una aplicación de Active Directory y asignar la aplicación a un rol.
+
Para más detalles, consulte https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions/["Documentación de Microsoft Azure: Permisos necesarios"^]

. Desde el portal de Azure, abra el servicio *Microsoft Entra ID*.
+
image:screenshot_azure_ad.png["Muestra el servicio Active Directory en Microsoft Azure."]

. En el menú, seleccione *Registros de aplicaciones*.
. Seleccione *Nuevo registro*.
. Especifique detalles sobre la aplicación:
+
** *Nombre*: Ingrese un nombre para la aplicación.
** *Tipo de cuenta*: seleccione un tipo de cuenta (cualquiera funcionará con la NetApp Console).
** *URI de redirección*: Puede dejar este campo en blanco.


. Seleccione *Registrarse*.
+
Ha creado la aplicación AD y la entidad principal de servicio.



.Asignar la aplicación a un rol
. Crear un rol personalizado:
+
Tenga en cuenta que puede crear un rol personalizado de Azure mediante el portal de Azure, Azure PowerShell, la CLI de Azure o la API REST.  Los siguientes pasos muestran cómo crear el rol mediante la CLI de Azure.  Si prefiere utilizar un método diferente, consulte https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles#steps-to-create-a-custom-role["Documentación de Azure"^]

+
.. Copiar el contenido dellink:reference-permissions-azure.html["Permisos de roles personalizados para el agente de la consola"] y guardarlos en un archivo JSON.
.. Modifique el archivo JSON agregando identificadores de suscripción de Azure al ámbito asignable.
+
Debe agregar el ID de cada suscripción de Azure desde la cual los usuarios crearán sistemas Cloud Volumes ONTAP .

+
*Ejemplo*

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz",
"/subscriptions/54b91999-b3e6-4599-908e-416e0zzzzzzz",
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"
----
.. Utilice el archivo JSON para crear un rol personalizado en Azure.
+
Los siguientes pasos describen cómo crear el rol mediante Bash en Azure Cloud Shell.

+
*** Comenzar https://docs.microsoft.com/en-us/azure/cloud-shell/overview["Azure Cloud Shell"^] y elija el entorno Bash.
*** Sube el archivo JSON.
+
image:screenshot_azure_shell_upload.png["Una captura de pantalla de Azure Cloud Shell donde puede elegir la opción de cargar un archivo."]

*** Utilice la CLI de Azure para crear el rol personalizado:
+
[source, azurecli]
----
az role definition create --role-definition Connector_Policy.json
----
+
Ahora debería tener un rol personalizado llamado Operador de consola que puede asignar a la máquina virtual del agente de consola.





. Asignar la aplicación al rol:
+
.. Desde el portal de Azure, abra el servicio *Suscripciones*.
.. Seleccione la suscripción.
.. Seleccione *Control de acceso (IAM) > Agregar > Agregar asignación de rol*.
.. En la pestaña *Rol*, seleccione el rol *Operador de consola* y seleccione *Siguiente*.
.. En la pestaña *Miembros*, complete los siguientes pasos:
+
*** Mantenga seleccionado *Usuario, grupo o entidad de servicio*.
*** Seleccionar *Seleccionar miembros*.
+
image:screenshot-azure-service-principal-role.png["Una captura de pantalla del portal de Azure que muestra la página Miembros al agregar un rol a una aplicación."]

*** Busque el nombre de la aplicación.
+
He aquí un ejemplo:

+
image:screenshot_azure_service_principal_role.png["Una captura de pantalla del portal de Azure que muestra el formulario Agregar asignación de rol en el portal de Azure."]

*** Seleccione la aplicación y seleccione *Seleccionar*.
*** Seleccione *Siguiente*.


.. Seleccione *Revisar + asignar*.
+
La entidad de servicio ahora tiene los permisos de Azure necesarios para implementar el agente de consola.

+
Si desea implementar Cloud Volumes ONTAP desde varias suscripciones de Azure, debe vincular la entidad de servicio a cada una de esas suscripciones.  En la NetApp Console, puede seleccionar la suscripción que desea utilizar al implementar Cloud Volumes ONTAP.





.Agregar permisos de la API de administración de servicios de Windows Azure
. En el servicio *Microsoft Entra ID*, seleccione *Registros de aplicaciones* y seleccione la aplicación.
. Seleccione *Permisos de API > Agregar un permiso*.
. En *API de Microsoft*, seleccione *Administración de servicios de Azure*.
+
image:screenshot_azure_service_mgmt_apis.gif["Una captura de pantalla del portal de Azure que muestra los permisos de la API de administración de servicios de Azure."]

. Seleccione *Acceder a Azure Service Management como usuarios de la organización* y luego seleccione *Agregar permisos*.
+
image:screenshot_azure_service_mgmt_apis_add.gif["Una captura de pantalla del portal de Azure que muestra cómo agregar las API de administración de servicios de Azure."]



.Obtenga el ID de la aplicación y el ID del directorio para la aplicación
. En el servicio *Microsoft Entra ID*, seleccione *Registros de aplicaciones* y seleccione la aplicación.
. Copie el *ID de la aplicación (cliente)* y el *ID del directorio (inquilino)*.
+
image:screenshot_azure_app_ids.gif["Una captura de pantalla que muestra el ID de la aplicación (cliente) y el ID del directorio (inquilino) de una aplicación en Microsoft Entra IDy."]

+
Cuando agrega la cuenta de Azure a la consola, debe proporcionar el identificador de la aplicación (cliente) y el identificador del directorio (inquilino) para la aplicación.  La consola utiliza los ID para iniciar sesión mediante programación.



.Crear un secreto de cliente
. Abra el servicio *Microsoft Entra ID*.
. Selecciona *Registros de aplicaciones* y selecciona tu aplicación.
. Seleccione *Certificados y secretos > Nuevo secreto de cliente*.
. Proporcione una descripción del secreto y una duración.
. Seleccione *Agregar*.
. Copia el valor del secreto del cliente.
+
image:screenshot_azure_client_secret.gif["Una captura de pantalla del portal de Azure que muestra un secreto de cliente para la entidad de servicio de Microsoft Entra."]



--
====


== Paso 4: Crear el agente de consola

Inicie el agente de consola directamente desde Azure Marketplace.

.Acerca de esta tarea
Al crear el agente de consola desde Azure Marketplace, se configura una máquina virtual con una configuración predeterminada. link:reference-agent-default-config.html["Obtenga información sobre la configuración predeterminada para el agente de la consola"] .

.Antes de empezar
Debes tener lo siguiente:

* Una suscripción de Azure.
* Una red virtual y una subred en la región de Azure que elija.
* Detalles sobre un servidor proxy, si su organización requiere un proxy para todo el tráfico de Internet saliente:
+
** Dirección IP
** Cartas credenciales
** Certificado HTTPS


* Una clave pública SSH, si desea utilizar ese método de autenticación para la máquina virtual del agente de consola.  La otra opción para el método de autenticación es utilizar una contraseña.
+
https://learn.microsoft.com/en-us/azure/virtual-machines/linux-vm-connect?tabs=Linux["Obtenga información sobre cómo conectarse a una máquina virtual Linux en Azure"^]

* Si no desea que la consola cree automáticamente un rol de Azure para el agente de la consola, deberá crear el suyo propio.link:reference-permissions-azure.html["utilizando la política de esta página"] .
+
Estos permisos son para la propia instancia del agente de consola.  Es un conjunto de permisos diferente al que configuró previamente para implementar la máquina virtual del agente de consola.



.Pasos
. Vaya a la página de la máquina virtual del agente de la NetApp Console en Azure Marketplace.
+
https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.netapp-oncommand-cloud-manager["Página de Azure Marketplace para regiones comerciales"^]

. Seleccione *Obtenerlo ahora* y luego seleccione *Continuar*.
. Desde el portal de Azure, seleccione *Crear* y siga los pasos para configurar la máquina virtual.
+
Tenga en cuenta lo siguiente al configurar la máquina virtual:

+
** *Tamaño de VM*: elija un tamaño de VM que cumpla con los requisitos de CPU y RAM.  Recomendamos Standard_D8s_v3.
** *Discos*: El agente de consola puede funcionar de manera óptima con discos HDD o SSD.
** *Grupo de seguridad de red*: el agente de consola requiere conexiones entrantes mediante SSH, HTTP y HTTPS.
+
link:reference-ports-azure.html["Ver las reglas del grupo de seguridad para Azure"] .

** Identidad*: En *Administración*, seleccione *Habilitar identidad administrada asignada por el sistema*.
+
Esta configuración es importante porque una identidad administrada permite que la máquina virtual del agente de consola se identifique con Microsoft Entra ID sin proporcionar ninguna credencial. https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["Obtenga más información sobre las identidades administradas para los recursos de Azure"^] .



. En la página *Revisar + crear*, revise sus selecciones y seleccione *Crear* para iniciar la implementación.
+
Azure implementa la máquina virtual con la configuración especificada.  Debería ver la máquina virtual y el software del agente de consola ejecutándose en aproximadamente diez minutos.

+

NOTE: Si la instalación falla, puede ver registros y un informe para ayudarlo a solucionar problemas.link:task-troubleshoot-agent.html#troubleshoot-installation["Aprenda a solucionar problemas de instalación."]

. Abra un navegador web desde un host que tenga una conexión a la máquina virtual del agente de consola e ingrese la siguiente URL:
+
https://_ipaddress_[]

. Después de iniciar sesión, configure el agente de la consola:
+
.. Especifique la organización de la consola que se asociará con el agente de la consola.
.. Introduzca un nombre para el sistema.
.. En *¿Está ejecutando en un entorno seguro?* mantenga el modo restringido deshabilitado.
+
Mantenga el modo restringido deshabilitado para utilizar la consola en modo estándar.  Debe habilitar el modo restringido solo si tiene un entorno seguro y desea desconectar esta cuenta de los servicios de backend de la consola.  Si ese es el caso,link:task-quick-start-restricted-mode.html["Siga los pasos para comenzar a utilizar la consola en modo restringido"] .

.. Seleccione *Comencemos*.




.Resultado
Ahora ha instalado el agente de la consola y lo ha configurado con su organización de la consola.

Si tiene Azure Blob Storage en la misma suscripción de Azure donde creó el agente de consola, verá aparecer automáticamente un sistema de Azure Blob Storage en la página *Sistemas*. https://docs.netapp.com/us-en/bluexp-blob-storage/index.html["Aprenda a administrar Azure Blob Storage desde la consola"^]



== Paso 5: Proporcionar permisos al agente de la consola

Ahora que ha creado el agente de consola, debe proporcionarle los permisos que configuró previamente.  Al proporcionar los permisos, se permite que el agente de la consola administre sus datos y la infraestructura de almacenamiento en Azure.

[role="tabbed-block"]
====
.Rol personalizado
--
Vaya al portal de Azure y asigne el rol personalizado de Azure a la máquina virtual del agente de consola para una o más suscripciones.

.Pasos
. Desde el Portal de Azure, abra el servicio *Suscripciones* y seleccione su suscripción.
+
Es importante asignar el rol desde el servicio *Suscripciones* porque esto especifica el alcance de la asignación del rol a nivel de suscripción.  El _scope_ define el conjunto de recursos al que se aplica el acceso.  Si especifica un alcance en un nivel diferente (por ejemplo, en el nivel de máquina virtual), su capacidad para completar acciones desde la NetApp Console se verá afectada.

+
https://learn.microsoft.com/en-us/azure/role-based-access-control/scope-overview["Documentación de Microsoft Azure: Comprender el alcance de Azure RBAC"^]

. Seleccione *Control de acceso (IAM)* > *Agregar* > *Agregar asignación de rol*.
. En la pestaña *Rol*, seleccione el rol *Operador de consola* y seleccione *Siguiente*.
+

NOTE: Operador de consola es el nombre predeterminado proporcionado en la política.  Si eligió un nombre diferente para el rol, seleccione ese nombre en su lugar.

. En la pestaña *Miembros*, complete los siguientes pasos:
+
.. Asignar acceso a una *Identidad administrada*.
.. Seleccione *Seleccionar miembros*, seleccione la suscripción en la que se creó la máquina virtual del agente de consola, en *Identidad administrada*, elija *Máquina virtual* y, luego, seleccione la máquina virtual del agente de consola.
.. Seleccionar *Seleccionar*.
.. Seleccione *Siguiente*.
.. Seleccione *Revisar + asignar*.
.. Si desea administrar recursos en suscripciones de Azure adicionales, cambie a esa suscripción y repita estos pasos.




.¿Que sigue?
Ir a la https://console.netapp.com["NetApp Console"^] para comenzar a utilizar el agente de consola.

--
.Director de servicio
--
.Pasos
. Seleccione *Administración > Credenciales*.
. Seleccione *Agregar credenciales* y siga los pasos del asistente.
+
.. *Ubicación de credenciales*: seleccione *Microsoft Azure > Agente*.
.. *Definir credenciales*: ingrese información sobre la entidad de servicio de Microsoft Entra que otorga los permisos necesarios:
+
*** ID de la aplicación (cliente)
*** ID de directorio (inquilino)
*** Secreto del cliente


.. *Suscripción al Marketplace*: asocie una suscripción al Marketplace con estas credenciales suscribiéndose ahora o seleccionando una suscripción existente.
.. *Revisar*: Confirme los detalles sobre las nuevas credenciales y seleccione *Agregar*.




.Resultado
La consola ahora tiene los permisos que necesita para realizar acciones en Azure en su nombre.

--
====